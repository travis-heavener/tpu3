section text
    ; Sleeps a given number of seconds
    ; Arguments:
    ;   EAX: number of seconds to sleep, as a u32
    ; Modifies:
    ;   none
    ; Returns:
    ;   none
    sleep:
        pushdw EDX              ; Save EDX
        pushdw EBX              ; Save EBX
        pushdw EAX              ; Save EAX
        mov EDX, EAX            ; Store duration in EDX

        ; Get current time
        mov EAX, 9              ; Time() is syscall 9
        syscall                 ; Time() syscall
        add EDX, EBX            ; Store wakeup time in EDX

        __sleep_loop:
            mov EAX, 9          ; Time() is syscall 9
            syscall             ; Time() syscall
            cmp EDX, EBX        ; Loop condition
            jc __sleep_end      ; End if carry set (EBX > EDX)
            jz __sleep_end      ; End if zero set (EBX == EDX)
            jmp __sleep_loop    ; Continue (EBX < EDX)

        __sleep_end:
            popdw EAX               ; Restore EAX
            popdw EBX               ; Restore EBX
            popdw EDX               ; Restore EDX
            ret

        ; Zeroes out a block of memory
        ; Arguments:
        ;   ESI: pointer to memory to zero
        ;   EAX: size of memory block
        ; Modifies:
        ;   none
        ; Returns:
        ;   none
        memzero:
            push BL             ; Save BL
            pushdw ECX          ; Save ECX
            pushdw EDX          ; Save EDX

            mov BL, 0           ; Const zero
            mov ECX, 0          ; Iterator
            mov EDX, ESI        ; EDX = ESI

            __memzero_loop:
                ; Check loop condition
                cmp EAX, ECX
                jz __memzero_end

                ; Otherwise, zero the byte
                sb BL, EDX

                ; Increment
                add ECX, 1
                add EDX, 1
                jmp __memzero_loop

            __memzero_end:
                popdw EDX           ; Restore EDX
                popdw ECX           ; Restore ECX
                pop BL              ; Restore BL
                ret

