section text
    ; Sleeps a given number of seconds
    ; Arguments:
    ;   EAX: number of seconds to sleep, as a u32
    ; Modifies:
    ;   none
    ; Returns:
    ;   none
    sleep:
        pushdw EDX              ; Save EDX
        pushdw EBX              ; Save EBX
        pushdw EAX              ; Save EAX
        mov EDX, EAX            ; Store duration in EDX

        ; Get current time
        mov EAX, 9              ; Time() is syscall 9
        syscall                 ; Time() syscall
        add EDX, EBX            ; Store wakeup time in EDX

        __sleep_loop:
            mov EAX, 9          ; Time() is syscall 9
            syscall             ; Time() syscall
            cmp EDX, EBX        ; Loop condition
            jc __sleep_end      ; End if carry set (EBX > EDX)
            jz __sleep_end      ; End if zero set (EBX == EDX)
            jmp __sleep_loop    ; Continue (EBX < EDX)

        __sleep_end:
            popdw EAX               ; Restore EAX
            popdw EBX               ; Restore EBX
            popdw EDX               ; Restore EDX
            ret

    ; Prints a strz to stdout
    ; Arguments:
    ;   ESI: the pointer to the strz to print
    ; Modifies:
    ;   EAX
    ; Returns:
    ;   EAX: the number of bytes written
    printz:
        pushdw RP       ; Save RP
        call strlen     ; Calculate welcome message length
        mov ECX, EAX    ; Save strlen(ESI)
        mov EBX, 1      ; fd = stdout
        mov EAX, 1      ; Write() syscall
        syscall
        popdw RP        ; Restore RP
        ret

    ; Prints n characters of a strz to stdout
    ; Arguments:
    ;   ESI: the pointer to the strz to print
    ;   ECX: the number of characters to print
    ; Modifies:
    ;   EAX
    ; Returns:
    ;   EAX: the number of bytes written, as a u32
    printnz:
        mov EBX, 1      ; fd = stdout
        mov EAX, 1      ; Write() syscall
        syscall
        ret

    ; Reads n characters from stdin
    ; Arguments:
    ;   EDI: the pointer to write to
    ;   ECX: the size of the pointer buffer
    ; Modifies:
    ;   EAX
    ; Returns:
    ;   EAX: the number of bytes read, as a u32
    readn:
        mov EAX, 2              ; Read() syscall
        mov EBX, 0              ; fd = stdin
        syscall
        ret
