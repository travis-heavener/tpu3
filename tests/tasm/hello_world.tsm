;section kernel-data
;    u32 USER_SPACE_START        0x00040000

section kernel
    ; Simple test
    syscall_1:
        mov ECX, 0x98765432
        sysret

    ; Cleans up and stops the TPU
    syscall_22:
        mov EDX, syscall_22
        hlt

    _kernel_start:
        ; Populate syscall table
        setsyscall 1, syscall_1
        setsyscall 22, syscall_22

        ; Start user program
        uret @0x00040000, @0x00050000

section text
    _start:
        ; Do something
        mov EBX, 99

        ; Invoke test syscall
        mov EAX, 1
        syscall

        ; Kill the TPU
        mov EAX, 22
        syscall
