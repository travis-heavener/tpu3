section kernel-data
    u32 USER_SPACE_START    0x00040000

section kernel
    ; Cleans up and stops the TPU
    syscall_22:
        mov EDX, syscall_22
        hlt

    _kernel_start:
        ; Populate syscall table
        setsyscall 22, syscall_22

        ; Start user program
        uret @0x00040000, @0x00050000

section data
    str WELCOME_MSG         "Welcome to TPUOS\n"
    u32 WELCOME_MSG_LEN     17

section text
    _start:
        ; Write welcome message
        mov EAX, 1
        mov EBX, WELCOME_MSG_LEN
        mov ESI, WELCOME_MSG
        syscall

        ; Kill the TPU
        mov EAX, 22
        syscall
